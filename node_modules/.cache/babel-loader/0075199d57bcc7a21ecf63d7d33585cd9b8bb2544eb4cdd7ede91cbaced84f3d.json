{"ast":null,"code":"import useWeb3 from \"../hooks/useWeb3\";\nimport { ref, onMounted } from \"vue\";\nexport default {\n  __name: 'BoardView',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const {\n      web3,\n      voteContract,\n      getAccount\n    } = useWeb3();\n\n    // 看板信息\n    const board = ref([]);\n    const account = ref(\"\");\n    const getBoardInfo = async () => {\n      const result = await voteContract.methods.getBoardInfo().call();\n      board.value = result;\n    };\n    const vote = async index => {\n      const account = await getAccount();\n      const result = await voteContract.methods.vote(index).send({\n        from: account\n      });\n    };\n    const initEventListen = () => {\n      voteContract.events.voteSuccess({\n        fromBlock: 0\n      }, (err, event) => {\n        console.log(\"监听执行\");\n        console.log(event);\n      }).on(\"data\", event => {\n        console.log(\"智能合约触发的事件：\", event.returnValues);\n      });\n    };\n    onMounted(() => {\n      initEventListen();\n      getBoardInfo();\n    });\n    const __returned__ = {\n      web3,\n      voteContract,\n      getAccount,\n      board,\n      account,\n      getBoardInfo,\n      vote,\n      initEventListen,\n      get useWeb3() {\n        return useWeb3;\n      },\n      ref,\n      onMounted\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["useWeb3","ref","onMounted","web3","voteContract","getAccount","board","account","getBoardInfo","result","methods","call","value","vote","index","send","from","initEventListen","events","voteSuccess","fromBlock","err","event","console","log","on","returnValues"],"sources":["D:/a/wallet-demo/web3-vote/src/views/BoardView.vue"],"sourcesContent":["<script setup>\nimport useWeb3 from \"../hooks/useWeb3\";\nimport { ref, onMounted } from \"vue\";\nconst { web3, voteContract, getAccount } = useWeb3();\n\n// 看板信息\nconst board = ref([]);\n\nconst account = ref(\"\");\n\nconst getBoardInfo = async () => {\n  const result = await voteContract.methods.getBoardInfo().call();\n  board.value = result;\n};\n\nconst vote = async (index) => {\n  const account = await getAccount();\n  const result = await voteContract.methods.vote(index).send({ from: account });\n};\n\nconst initEventListen = () => {\n  voteContract.events\n    .voteSuccess({ fromBlock: 0 }, (err, event) => {\n      console.log(\"监听执行\");\n      console.log(event);\n    })\n    .on(\"data\", (event) => {\n      console.log(\"智能合约触发的事件：\", event.returnValues);\n    });\n};\n\nonMounted(() => {\n  initEventListen();\n  getBoardInfo();\n});\n</script>\n\n<template>\n  <div class=\"box3\">\n    <van-divider>投票看板</van-divider>\n    <van-cell :title=\"item.name\" icon=\"shop-o\" v-for=\"(item, index) in board\">\n      <template #right-icon>\n        <van-button @click=\"vote(index)\">{{ item.totalAmount }}</van-button>\n      </template>\n    </van-cell>\n  </div>\n</template>\n\n<style lang=\"less\"></style>\n"],"mappings":"AACA,OAAOA,OAAO,MAAM,kBAAkB;AACtC,SAASC,GAAG,EAAEC,SAAS,QAAQ,KAAK;;;;;;;IACpC,MAAM;MAAEC,IAAI;MAAEC,YAAY;MAAEC;IAAW,CAAC,GAAGL,OAAO,CAAC,CAAC;;IAEpD;IACA,MAAMM,KAAK,GAAGL,GAAG,CAAC,EAAE,CAAC;IAErB,MAAMM,OAAO,GAAGN,GAAG,CAAC,EAAE,CAAC;IAEvB,MAAMO,YAAY,GAAG,MAAAA,CAAA,KAAY;MAC/B,MAAMC,MAAM,GAAG,MAAML,YAAY,CAACM,OAAO,CAACF,YAAY,CAAC,CAAC,CAACG,IAAI,CAAC,CAAC;MAC/DL,KAAK,CAACM,KAAK,GAAGH,MAAM;IACtB,CAAC;IAED,MAAMI,IAAI,GAAG,MAAOC,KAAK,IAAK;MAC5B,MAAMP,OAAO,GAAG,MAAMF,UAAU,CAAC,CAAC;MAClC,MAAMI,MAAM,GAAG,MAAML,YAAY,CAACM,OAAO,CAACG,IAAI,CAACC,KAAK,CAAC,CAACC,IAAI,CAAC;QAAEC,IAAI,EAAET;MAAQ,CAAC,CAAC;IAC/E,CAAC;IAED,MAAMU,eAAe,GAAGA,CAAA,KAAM;MAC5Bb,YAAY,CAACc,MAAM,CAChBC,WAAW,CAAC;QAAEC,SAAS,EAAE;MAAE,CAAC,EAAE,CAACC,GAAG,EAAEC,KAAK,KAAK;QAC7CC,OAAO,CAACC,GAAG,CAAC,MAAM,CAAC;QACnBD,OAAO,CAACC,GAAG,CAACF,KAAK,CAAC;MACpB,CAAC,CAAC,CACDG,EAAE,CAAC,MAAM,EAAGH,KAAK,IAAK;QACrBC,OAAO,CAACC,GAAG,CAAC,YAAY,EAAEF,KAAK,CAACI,YAAY,CAAC;MAC/C,CAAC,CAAC;IACN,CAAC;IAEDxB,SAAS,CAAC,MAAM;MACde,eAAe,CAAC,CAAC;MACjBT,YAAY,CAAC,CAAC;IAChB,CAAC,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}